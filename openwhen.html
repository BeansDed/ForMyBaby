<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#f43f5e">
  <title>Open When Letters â™¡</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Playfair+Display:wght@400;500;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    .letters-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(min(250px, 100%), 1fr));
      gap: clamp(16px, 4vw, 20px);
      margin: clamp(24px, 6vw, 32px) 0;
    }
    
    .letter-envelope {
      position: relative;
      background: linear-gradient(145deg, var(--rose-50), var(--rose-100));
      border: 2px solid var(--rose-300);
      border-radius: clamp(12px, 3vw, 16px);
      padding: clamp(20px, 5vw, 28px);
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      min-height: clamp(140px, 35vw, 180px);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }
    
    .letter-envelope:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-medium);
      border-color: var(--rose-400);
    }
    
    .letter-envelope.opened {
      background: linear-gradient(145deg, #d1fae5, #a7f3d0);
      border-color: #10b981;
    }
    
    .envelope-icon {
      font-size: clamp(36px, 9vw, 48px);
      margin-bottom: clamp(10px, 2.5vw, 12px);
      animation: floatEnvelope 3s ease-in-out infinite;
    }
    
    @keyframes floatEnvelope {
      0%, 100% {
        transform: translateY(0) rotate(-2deg);
      }
      50% {
        transform: translateY(-8px) rotate(2deg);
      }
    }
    
    .letter-title {
      color: var(--rose-700);
      font-family: var(--font-hand);
      font-size: clamp(18px, 4.5vw, 22px);
      margin: clamp(8px, 2vw, 10px) 0;
      font-weight: 700;
    }
    
    .letter-preview {
      color: var(--mauve);
      font-size: clamp(13px, 3.2vw, 15px);
      font-style: italic;
      margin: clamp(4px, 1vw, 6px) 0;
    }
    
    .opened-badge {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #10b981;
      color: white;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: clamp(10px, 2.5vw, 12px);
      font-weight: 700;
      display: none;
    }
    
    .letter-envelope.opened .opened-badge {
      display: block;
      animation: bounceIn 0.5s ease;
    }
    
    @keyframes bounceIn {
      0% {
        transform: scale(0);
      }
      50% {
        transform: scale(1.2);
      }
      100% {
        transform: scale(1);
      }
    }
    
    /* Modal styles */
    .letter-modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
      animation: fadeIn 0.3s ease;
    }
    
    .letter-modal.show {
      display: flex;
    }
    
    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }
    
    .letter-content {
      background: var(--white);
      border: 3px solid var(--rose-300);
      border-radius: clamp(16px, 4vw, 24px);
      padding: clamp(28px, 7vw, 40px);
      max-width: 600px;
      width: 100%;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
      animation: slideUp 0.5s ease;
    }
    
    @keyframes slideUp {
      from {
        transform: translateY(50px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }
    
    .letter-close {
      position: absolute;
      top: 15px;
      right: 15px;
      background: var(--rose-500);
      color: white;
      border: none;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      font-size: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .letter-close:hover {
      background: var(--rose-600);
      transform: rotate(90deg);
    }
    
    .letter-header {
      text-align: center;
      margin-bottom: clamp(20px, 5vw, 28px);
    }
    
    .letter-header h2 {
      color: var(--rose-600);
      font-family: var(--font-hand);
      font-size: clamp(28px, 7vw, 36px);
      margin: 0 0 clamp(8px, 2vw, 10px);
    }
    
    .letter-header .emoji {
      font-size: clamp(36px, 9vw, 48px);
      margin-bottom: clamp(10px, 2.5vw, 12px);
    }
    
    .letter-body {
      font-family: var(--font-serif);
      font-size: clamp(15px, 3.8vw, 17px);
      line-height: 1.75;
      color: var(--text-dark);
    }
    
    .letter-body p {
      margin: clamp(12px, 3vw, 16px) 0;
    }
    
    .letter-signature {
      text-align: right;
      margin-top: clamp(20px, 5vw, 28px);
      font-style: italic;
      color: var(--rose-600);
      font-family: var(--font-hand);
      font-size: clamp(18px, 4.5vw, 22px);
    }
  </style>
</head>
<body>
  <div class="lace-overlay"></div>
  <div class="floating-hearts" aria-hidden="true"></div>
  
  <div class="container">
    <div class="page">
      <div class="topbar">
        <a href="index.html" class="back-link">â† Back to Home</a>
      </div>
      
      <div class="sparkles" aria-hidden="true">
        <span class="sparkle">âœ§</span>
        <span class="sparkle">âœ¦</span>
        <span class="sparkle">âœ§</span>
      </div>
      
      <h1 class="page-title">Open When Letters</h1>
      <div class="heart-divider">â™¡</div>
      
      <p style="text-align: center; color: var(--mauve); margin: 20px auto; max-width: 600px; font-size: clamp(14px, 3.5vw, 16px);">
        For those moments when you need a little extra love. Click on any letter when the time feels right. ğŸ’•
      </p>
      
      <div class="letters-grid" id="lettersGrid"></div>
      
      <div class="love-message">
        <div class="bow-accent">ğŸ’</div>
        <p class="message-text">These letters are little pieces of my heart, waiting for you â™¡</p>
      </div>
    </div>
  </div>
  
  <!-- Letter Modal -->
  <div class="letter-modal" id="letterModal" onclick="closeModal(event)">
    <div class="letter-content" onclick="event.stopPropagation()">
      <button class="letter-close" onclick="closeModal()">Ã—</button>
      <div id="letterBody"></div>
    </div>
  </div>

  <script src="api-helper.js"></script>
  <script src="script.js"></script>
  <script>
    const presetLetters = {
      miss: {
        emoji: 'ğŸ’•',
        title: 'When You Miss Me',
        content: `
          <p>My darling,</p>
          <p>I know the distance can feel heavy sometimes, like a weight on your heart. But I want you to know that even though we're apart right now, you're never far from my thoughts.</p>
          <p>Every moment without you makes me appreciate the moments we have together even more. Close your eyes and imagine my arms around you, because that's exactly where my heart is right now.</p>
          <p>Remember our last hug? I'm saving up the next one, and it's going to be even longer and warmer. Until then, know that you're loved beyond measure, missed beyond words, and thought of more than you could ever imagine.</p>
          <p>Soon, my love. Soon we'll be together again. â™¡</p>
        `
      },
      sad: {
        emoji: 'ğŸ¤—',
        title: 'When You're Sad',
        content: `
          <p>Sweet baby,</p>
          <p>I wish I could be there right now to wrap you in the biggest hug and wipe away every tear. Even though I can't physically be there, I'm sending you all my love and warmth through these words.</p>
          <p>It's okay to feel sad. It's okay to cry. Your feelings are valid, and I'm here for you through it allâ€”the good days and the tough ones too.</p>
          <p>Remember: this feeling is temporary. The sun will shine again, smiles will come easier, and this moment will pass. You're so much stronger than you know, and you've overcome so much already.</p>
          <p>I love you in your happiness and in your sadness. All of you, always. ğŸ’™</p>
        `
      },
      happy: {
        emoji: 'ğŸ‰',
        title: 'When You're Happy',
        content: `
          <p>My sunshine,</p>
          <p>Your happiness is contagious! Even reading about it or seeing your smile makes my whole world brighter. I'm so glad you're having a wonderful moment right now!</p>
          <p>This is what life is aboutâ€”these beautiful, joy-filled moments that make everything worthwhile. I wish I could be there celebrating with you, dancing around and laughing until our stomachs hurt.</p>
          <p>Soak it all in, my love. Feel every bit of this happiness. You deserve all the good things happening to you and so much more.</p>
          <p>Keep shining, beautiful. Your joy lights up my life! âœ¨</p>
        `
      },
      stressed: {
        emoji: 'ğŸŒ¸',
        title: 'When You're Stressed',
        content: `
          <p>Breathe, my love. Just breathe.</p>
          <p>I know things feel overwhelming right now. Like everything is piling up and you can't catch a break. But I want you to take a momentâ€”just for yourself.</p>
          <p>Close your eyes. Take a deep breath in... and out. Again. Feel your shoulders relax.</p>
          <p>Remember: You don't have to do everything perfectly. You don't have to do everything right now. One step at a time, one task at a time. You've got this.</p>
          <p>And if you need to take a break, take it. Rest is not weakness; it's wisdom. I'm proud of you for everything you do, stressed or not.</p>
          <p>You're amazing, capable, and stronger than any challenge. I believe in you. ğŸ’ªğŸ’•</p>
        `
      },
      morning: {
        emoji: 'â˜€ï¸',
        title: 'Good Morning, Sunshine',
        content: `
          <p>Good morning, beautiful! â˜€ï¸</p>
          <p>I hope you slept well and woke up feeling refreshed. As you start this new day, I want you to know that you're the first thing I think about in the morning.</p>
          <p>Today is full of possibilities! Whatever comes your way, I know you'll handle it with grace and strength. You're going to do amazing things today.</p>
          <p>Don't forget to:</p>
          <p>â€¢ Drink some water ğŸ’§<br>
          â€¢ Eat a good breakfast ğŸ³<br>
          â€¢ Smile at yourself in the mirror ğŸ˜Š<br>
          â€¢ Remember how loved you are ğŸ’•</p>
          <p>Have a wonderful day, my love. I'll be thinking of you!</p>
        `
      },
      night: {
        emoji: 'ğŸŒ™',
        title: 'Good Night, My Love',
        content: `
          <p>Good night, my darling ğŸŒ™</p>
          <p>As you lay down to sleep, I want you to know that you've made it through another day, and I'm so proud of you. Whatever happened todayâ€”the good, the bad, the in-betweenâ€”you did your best, and that's all that matters.</p>
          <p>Let go of any worries or stress. Tomorrow is a new day, but tonight is for rest. Close your eyes and think of all the things that made you smile today.</p>
          <p>Imagine I'm there with you, holding you close, keeping you safe and warm. Feel the love I'm sending across the distance.</p>
          <p>Sweet dreams, my precious one. May your sleep be peaceful and your dreams be beautiful. I'll see you in my dreams tonight. ğŸ’«</p>
          <p>I love you to the moon and back. ğŸŒ™âœ¨</p>
        `
      },
      success: {
        emoji: 'ğŸ†',
        title: 'You Did It!',
        content: `
          <p>I KNEW YOU COULD DO IT! ğŸ‰</p>
          <p>Oh my goodness, I'm so incredibly proud of you! Do you have any idea how amazing you are? You set your mind to something, worked hard, and made it happen!</p>
          <p>This success didn't come by accidentâ€”it came because of your dedication, your talent, your persistence, and your incredible spirit. You earned this!</p>
          <p>Take a moment to really celebrate. You deserve to feel proud, to be happy, to recognize just how wonderful you are. Don't downplay thisâ€”own it!</p>
          <p>I wish I could be there to give you the biggest hug and spin you around in celebration! But know that I'm cheering for you louder than anyone, so proud my heart could burst!</p>
          <p>You're a superstar, and this is just the beginning! ğŸŒŸ</p>
        `
      },
      doubt: {
        emoji: 'ğŸ’ª',
        title: 'You Are Enough',
        content: `
          <p>Listen to me, my love,</p>
          <p>That voice in your head telling you that you're not good enough? It's lying. That doubt creeping in? It doesn't know what I know.</p>
          <p>I've seen you overcome challenges that would break other people. I've watched you grow, learn, and become stronger. I've witnessed your kindness, your intelligence, your creativity, and your heart.</p>
          <p>You are MORE than capable. You are MORE than enough. You are exceptional.</p>
          <p>Everyone feels doubt sometimesâ€”even the most confident people. But doubt doesn't define you. Your actions, your heart, your spiritâ€”that's what defines you.</p>
          <p>Believe in yourself the way I believe in you. Because from where I'm standing, you're absolutely incredible. And one day, I hope you see yourself through my eyes.</p>
          <p>You've got this. I know you do. ğŸ’•</p>
        `
      },
      birthday: {
        emoji: 'ğŸ‚',
        title: 'Happy Birthday!',
        content: `
          <p>ğŸ‰ HAPPY BIRTHDAY, MY LOVE! ğŸ‰</p>
          <p>Today is the day the world became infinitely better because YOU were born. The universe aligned to create someone so incredibly special, and I'm the luckiest person alive to know you.</p>
          <p>On your birthday, I want you to know:</p>
          <p>â€¢ You make the world brighter just by being in it ğŸŒŸ<br>
          â€¢ Every year with you is a gift ğŸ<br>
          â€¢ You deserve all the happiness today and every day ğŸ’•<br>
          â€¢ I'm so grateful you were born ğŸ‚</p>
          <p>This year is going to be amazing for youâ€”I can feel it. So many beautiful moments, so many dreams coming true, so much love and laughter ahead.</p>
          <p>I hope your birthday is as special, wonderful, and magical as you are. Celebrate yourself today, because you truly deserve it!</p>
          <p>All my love, today and always. Happy Birthday, beautiful! ğŸŠğŸ’•ğŸˆ</p>
        `
      },
      random: {
        emoji: 'âœ¨',
        title: 'Just Because',
        content: `
          <p>Hey you,</p>
          <p>There's no special reason for this letter. No specific occasion. I just wanted to remind you that you're loved.</p>
          <p>Sometimes we need to hear it on a random Tuesday afternoon. Sometimes we need to be reminded when everything is normal and ordinary.</p>
          <p>You are:</p>
          <p>â€¢ Loved ğŸ’•<br>
          â€¢ Important ğŸŒŸ<br>
          â€¢ Valued ğŸ’<br>
          â€¢ Beautiful âœ¨<br>
          â€¢ Cherished ğŸ’</p>
          <p>Not because of what you do or what you achieve, but simply because of who you are. You don't have to earn loveâ€”you already have mine, completely and unconditionally.</p>
          <p>I hope this letter made you smile. That was the whole point. ğŸ˜Š</p>
          <p>Love you endlessly,<br>Always â™¡</p>
        `
      }
    };
    
    function openLetter(element, data) {
      element.classList.add('opened');
      const letter = data;
      
      const modal = document.getElementById('letterModal');
      const body = document.getElementById('letterBody');
      
      body.innerHTML = `
        <div class="letter-header">
          <div class="emoji">${letter.emoji}</div>
          <h2>${letter.title}</h2>
        </div>
        <div class="letter-body">
          ${letter.content}
          <div class="letter-signature">
            Forever yours, â™¡<br>
            Your Love
          </div>
        </div>
      `;
      
      modal.classList.add('show');
      document.body.style.overflow = 'hidden';
      
      // Save opened state
      if (letter._id) API.markLetterOpened(letter._id).catch(()=>{});
      createConfetti();
    }
    
    function closeModal(event) {
      if (!event || event.target.id === 'letterModal') {
        const modal = document.getElementById('letterModal');
        modal.classList.remove('show');
        document.body.style.overflow = 'auto';
      }
    }
    
    function renderLetters(data) {
      const grid = document.getElementById('lettersGrid');
      grid.innerHTML = '';
      const letters = data.length ? data : Object.keys(presetLetters).map(k => presetLetters[k]);
      letters.forEach(letter => {
        const el = document.createElement('div');
        el.className = 'letter-envelope' + (letter.opened ? ' opened' : '');
        el.onclick = () => openLetter(el, letter);
        el.innerHTML = `
          <span class="opened-badge">âœ“ Read</span>
          <div class="envelope-icon">${letter.emoji || 'ğŸ’Œ'}</div>
          <div class="letter-title">${letter.title}</div>
          <div class="letter-preview">${(letter.content || '').slice(0, 60)}...</div>`;
        grid.appendChild(el);
      });
    }
    
    // Close modal on Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeModal();
      }
    });
    
    async function loadLetters() {
      try {
        const letters = await API.getOpenWhenLetters();
        renderLetters(letters);
      } catch (e) {
        console.log('Failed to load letters, using preset', e);
        renderLetters([]);
      }
    }
    window.addEventListener('DOMContentLoaded', loadLetters);
  </script>
</body>
</html>



